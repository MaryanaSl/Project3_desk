Ниже приведу код, используемый в десктопной версии

1. Реализван план обмена с реквизитом "Пользователь"
![image](https://github.com/user-attachments/assets/01ea869a-9662-42fd-b8eb-030397726c28)

![image](https://github.com/user-attachments/assets/691394f8-8f4f-4b47-a7ed-939c1f19fb14)

2. Реализация регистрации Документа доставка на всех узлах плана обмена по реквизиту Отвественный - модуль объекта документа Доработка_Доставка

<details>
	
 <summary><u>Модуль объекта документа Доработка_Доставка</u></summary>
 
```bsl
Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	// Реализуйте регистрацию документа «Доставка» на всех узлах плана обмена, 
	//у которых значение реквизита «Пользователь» заполнено и соответствует 
	//значению реквизита «Ответственный документа»  
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
 
	Запрос = Новый Запрос;
	Запрос.Текст ="ВЫБРАТЬ
	              |	ОбменСМобильнымПриложением.Ссылка КАК Ссылка
	              |ИЗ
	              |	ПланОбмена.ОбменСМобильнымПриложением КАК ОбменСМобильнымПриложением
	              |ГДЕ
	              |	ОбменСМобильнымПриложением.Пользователь = &Пользователь
	              |	И НЕ ОбменСМобильнымПриложением.ПометкаУдаления";
	
	Запрос.УстановитьПараметр("Пользователь", Ответственный);
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Пока Выборка.Следующий() Цикл
		ОбменДанными.Получатели.Добавить(Выборка.Ссылка);
	КонецЦикла; 
				  
КонецПроцедуры
```
</details>

3. Реализация HTTP-сервиса для обмена с мобильным приложением. Создана роль для работы с сервисом и пользователя с логином Курьер. Сервис при первом вызове инициализиует необходимые узлы планов обмена и выполняет первичную регистрацию объектов — документов «Доставка»‎, в которых реквизит «Ответственный»‎ соответствует текущему пользователю;
в качестве ответа передавать сериализованные данные документов, зарегистрированных на узле плана обмена, соответствующих устройству.

<details>
	
 <summary><u>Реализация HTTP-сервиса</u></summary>
 
```bsl
Функция exchangeПолучитьСписокЗаказов(Запрос)
	
	УстановитьПривилегированныйРежим(Истина);
	
	//инициализировать необходимые узлы планов обмена и выполнять первичную регистрацию объектов — 
	//документов «Доставка», в которых реквизит «Ответственный» соответствует текущему пользователю;
	ИдентификаторМобильного = Запрос.Заголовки.Получить("X_Mobile_ID");
	
	Попытка 
		
	//ищем узел обмена
	Узел = ПланыОбмена.ОбменСМобильнымПриложением.НайтиПоКоду(ИдентификаторМобильного); 
	
	//если не нашли создаем новый и регистрируем изменения
	СоздатьНовыйУзелИВыполнитьПервичнуюРегистрацию(ИдентификаторМобильного, Узел);
	
	ТекущийУзел = ПланыОбмена.ОбменСМобильнымПриложением.ЭтотУзел();
	
	//если текущего узла нет, то создать Центральный узел
	СоздатьЦентральныйУзел(ТекущийУзел);
	
	//если узел есть, то проверяем данные в узле для изменений
	// Получение зарегистрированных данных
    МассивДоставокДляВыгрузки = ПолучитьИзмененныеДанные(Узел);

    //создаем пакет данных
	ТелоОтвета = ЗаписатьЗначениеJSON(МассивДоставокДляВыгрузки);

	Ответ = Новый HTTPСервисОтвет(200);
	Ответ.УстановитьТелоИзСтроки(ТелоОтвета);
	
	Возврат Ответ;   

	Исключение 
	
    ЗаписьЖурналаРегистрации("exchangeПолучитьСписокЗаказов", УровеньЖурналаРегистрации.Ошибка,,,ОписаниеОшибки());

	КонецПопытки;     

КонецФункции

Функция ПолучитьИзмененныеДанные(Узел)
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
				|	Доработка_ДоставкаИзменения.Ссылка.Ссылка КАК Ссылка,
				|	Доработка_ДоставкаИзменения.Ссылка.Ответственный КАК Ответственный,
				|	Доработка_ДоставкаИзменения.Ссылка.ПометкаУдаления КАК ПометкаУдаления,
				|	Доработка_ДоставкаИзменения.Ссылка.Номер КАК Номер,
				|	Доработка_ДоставкаИзменения.Ссылка.Дата КАК Дата,
				|	Доработка_ДоставкаИзменения.Ссылка.Проведен КАК Проведен,
				|	Доработка_ДоставкаИзменения.Ссылка.Контрагент КАК Контрагент,
				|	Доработка_ДоставкаИзменения.Ссылка.АдресДоставки КАК АдресДоставки,
				|	Доработка_ДоставкаИзменения.Ссылка.Комментарий КАК Комментарий,
				|	Доработка_ДоставкаИзменения.Ссылка.Статус КАК Статус, 
				|	Доработка_ДоставкаИзменения.Ссылка.Контрагент.Код КАК КонтрагентКод,
				|	Доработка_ДоставкаИзменения.Ссылка.Контрагент.Родитель КАК КонтрагентРодитель,
				|	Доработка_ДоставкаИзменения.Ссылка.Контрагент.ЭтоГруппа КАК КонтрагентЭтоГруппа,
				|	Доработка_ДоставкаИзменения.Ссылка.Фото КАК Фото,
				|	Доработка_ДоставкаИзменения.Ссылка.Товары.(
				|		Ссылка КАК СсылкаСсылка,
				|		НомерСтроки КАК НомерСтроки,
				|		Номенклатура КАК Номенклатура,
				|		Количество КАК Количество,
				|		Номенклатура.Код КАК НоменклатураКод,
				|		Номенклатура.Родитель КАК НоменклатураРодитель,
				|		Номенклатура.ЭтоГруппа КАК НоменклатураЭтоГруппа
				|	) КАК Товары,
				|	Доработка_ДоставкаИзменения.Ссылка.Контрагент.КонтактнаяИнформация.(
				|		НомерТелефона КАК КонтрагентНомерТелефона
				|	) КАК КонтрагентТелефон
				|ИЗ
				|	Документ.Доработка_Доставка.Изменения КАК Доработка_ДоставкаИзменения
				|ГДЕ
				|	Доработка_ДоставкаИзменения.Узел = &Узел
				|	И Доработка_ДоставкаИзменения.Ссылка.Ответственный = &Ответственный";
	
	Запрос.УстановитьПараметр("Ответственный",Пользователи.ТекущийПользователь()); 
	Запрос.УстановитьПараметр("Узел",Узел);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	//обходим выборку если есть данные в плане обмена
	Выборка = РезультатЗапроса.Выбрать();
	
	// Сериализация зарегистрированных данных
	МассивДоставокДляВыгрузки = Новый Массив;
	МассивДляОтменыРегистрации = Новый Массив;
	
	//обходим выборку если есть данные в плане обмена
	//для передачи в JSON спреобразовать в строку, число, булево
	Пока Выборка.Следующий() Цикл   
		МассивДляОтменыРегистрации.Добавить(Выборка.Ссылка);
		ДоставкиИзменения = Новый Структура;
		ДоставкиИзменения.Вставить("Ссылка", Строка(Выборка.Ссылка.УникальныйИдентификатор()));
		ДоставкиИзменения.Вставить("Ответственный", Строка(Выборка.Ответственный));
		ДоставкиИзменения.Вставить("ПометкаУдаления", Выборка.ПометкаУдаления);
		ДоставкиИзменения.Вставить("Номер", Строка (Выборка.Номер));
		ДоставкиИзменения.Вставить("Дата", Формат (Выборка.Дата, "ДФ=dd.MM.yyyy"));
		ДоставкиИзменения.Вставить("Проведен", Выборка.Проведен);
		ДоставкиИзменения.Вставить("Контрагент", Строка(Выборка.Контрагент.УникальныйИдентификатор()));
		ДоставкиИзменения.Вставить("КонтрагентРодитель", Строка(Выборка.КонтрагентРодитель.УникальныйИдентификатор()));
		ДоставкиИзменения.Вставить("КонтрагентЭтоГруппа", Выборка.КонтрагентЭтоГруппа); 
		ДоставкиИзменения.Вставить("КонтрагентКод", Выборка.КонтрагентКод); 
		ДоставкиИзменения.Вставить("КонтрагентНаименование", Строка(Выборка.Контрагент)); 
		
		//получаем табличную часть из Контаткной информации справочника Контрагенты, для получения телефона
		ВыборкаТелефонКонтрагента = Выборка.КонтрагентТелефон.Выгрузить();
		МассивТелефон = Новый Массив;
		Для Каждого Строка Из ВыборкаТелефонКонтрагента Цикл
			СтрокаТаблицы = Новый структура;
			СтрокаТаблицы.Вставить("КонтрагентНомерТелефона",Строка (Строка.КонтрагентНомерТелефона)); 
			МассивТелефон.Добавить(СтрокаТаблицы);
		КонецЦикла;
		
		ДоставкиИзменения.Вставить("КонтрагентНомерТелефона", МассивТелефон);
		ДоставкиИзменения.Вставить("АдресДоставки", Выборка.АдресДоставки);
		ДоставкиИзменения.Вставить("Комментарий", Выборка.Комментарий);
		ДоставкиИзменения.Вставить("Статус", XMLСтрока(Выборка.Статус));
		ДоставкиИзменения.Вставить("Фото", Base64Строка(Выборка.Фото.Получить()));
		
		//получаем табличную часть Товары
		ВыборкаТЧ = Выборка.Товары.Выгрузить();
		МассивТЧ = Новый Массив;
		
		Для Каждого Строка Из ВыборкаТЧ Цикл
			СтрокаТаблицы = Новый структура;
			СтрокаТаблицы.Вставить("Номенклатура",Строка (Строка.Номенклатура.УникальныйИдентификатор())); 
			СтрокаТаблицы.Вставить("НоменклатураНаименование",Строка (Строка.Номенклатура)); 
			СтрокаТаблицы.Вставить("НоменклатураРодитель",Строка (Строка.НоменклатураРодитель.УникальныйИдентификатор()));  
			СтрокаТаблицы.Вставить("НоменклатураЭтоГруппа",Строка.НоменклатураЭтоГруппа);  
			СтрокаТаблицы.Вставить("НоменклатураКод",Строка.НоменклатураКод);  
			СтрокаТаблицы.Вставить("Количество", Строка.Количество);
			МассивТЧ.Добавить(СтрокаТаблицы);
		КонецЦикла;
		
		ДоставкиИзменения.Вставить("ТабличнаяЧасть", МассивТЧ);
		
		МассивДоставокДляВыгрузки.Добавить(ДоставкиИзменения); 
		
	КонецЦикла;
	
	//отменяем регистрацию
	Если МассивДляОтменыРегистрации.Количество() > 0 Тогда
		ПланыОбмена.УдалитьРегистрациюИзменений(Узел, МассивДляОтменыРегистрации);    
	КонецЕсли;
	
	Возврат МассивДоставокДляВыгрузки;
	
КонецФункции

Процедура СоздатьЦентральныйУзел(ТекущийУзел)
	
	Если Не ЗначениеЗаполнено(ТекущийУзел.Код) Тогда
		УзелОбъект = ТекущийУзел.ПолучитьОбъект();
		УзелОбъект.Код = "main";
		УзелОбъект.Наименование = "Центральный узел";
		УзелОбъект.Записать();
	КонецЕсли;

КонецПроцедуры

Процедура СоздатьНовыйУзелИВыполнитьПервичнуюРегистрацию(ИдентификаторМобильного, Узел)
	
	Если Не ЗначениеЗаполнено(Узел) Тогда
		УзелОбъект = ПланыОбмена.ОбменСМобильнымПриложением.СоздатьУзел();
		УзелОбъект.Код = ИдентификаторМобильного;
		УзелОбъект.Наименование = ИдентификаторМобильного;
		УзелОбъект.Пользователь = Пользователи.ТекущийПользователь();
		УзелОбъект.Записать();		
		Узел = УзелОбъект.Ссылка;
		ВыполнитьПервичнуюРегистрацию(Узел);
	КонецЕсли;

КонецПроцедуры

Процедура ВыполнитьПервичнуюРегистрацию(Узел)
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	Доработка_Доставка.Ссылка КАК Ссылка,
	               |	Доработка_Доставка.Ответственный КАК Ответственный
	               |ИЗ
	               |	Документ.Доработка_Доставка КАК Доработка_Доставка
	               |ГДЕ
	               |	Доработка_Доставка.Ответственный = &Ответственный";
	
	Запрос.УстановитьПараметр("Ответственный", Пользователи.ТекущийПользователь());
	Выборка = Запрос.Выполнить().Выбрать();
	ДанныеКРегистрации = Новый Массив;
	
	//обходим выборку и записываем изменения
	Пока Выборка.Следующий() Цикл
		ДанныеКРегистрации.Добавить(Выборка.Ссылка);
	КонецЦикла;
	
	ПланыОбмена.ЗарегистрироватьИзменения(Узел, ДанныеКРегистрации); 
	
КонецПроцедуры
```
</details>

4. Реализована возможность хранения фото в документе «Доставка»‎. Выведено изображение на форму документа. Создана процедура в http-сервисе для получения Комментария и Фото из мобильной версии

<details>
	
 <summary><u>Модуль формы документа Доставка</u></summary>
 
```bsl   
&НаСервере
Процедура ПриЧтенииНаСервере(ТекущийОбъект)
	
    // СтандартныеПодсистемы.ПодключаемыеКоманды
    ПодключаемыеКомандыКлиентСервер.ОбновитьКоманды(ЭтотОбъект, Объект);
    // Конец СтандартныеПодсистемы.ПодключаемыеКоманды

	// при открытии необходимо получить фото поместить ее во временное хранилище и заполнить реквизит формы
	ДвоичныеДанныеФото = ТекущийОбъект.Фото.Получить();
	АдресФото = ПоместитьВоВременноеХранилище(ДвоичныеДанныеФото, УникальныйИдентификатор);

КонецПроцедуры

&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	
	//Создайте обработчик формы ПередЗаписьюНаСервере, 
	//в котором поместите картинку в хранилище значения 
	//и сохраните в реквизит Фотография    
	Если ЗначениеЗаполнено(АдресФото) Тогда
		
		//получим двоичные данные фото
		ДвоичныеДанныеФото = ПолучитьИзВременногоХранилища(АдресФото);
		ДанныеВХранилище = Новый ХранилищеЗначения (ДвоичныеДанныеФото);
		ТекущийОбъект.Фото = ДанныеВХранилище;
	КонецЕсли; 
	
КонецПроцедуры
```
</details>

* Метод Post  в Http-сервисе по приему фото и комментария

![image](https://github.com/user-attachments/assets/1dc3b2dd-2b6e-46f7-b41d-084ad9977760)

<details>
	
 <summary><u>Метод Post  в Http-сервисе</u></summary>
 
```bsl   
Функция exchangeDeliveryОтправитьФотоИСтатус(Запрос)
	
	Ответ = Новый HTTPСервисОтвет(200); 
	
	ТекстОтвета = Запрос.ПолучитьТелоКакСтроку();
	МассивДоставок = ПрочитатьЗначениеJSON(ТекстОтвета);
	
	Для Каждого Доставка Из МассивДоставок Цикл
		
		ИД = Новый УникальныйИдентификатор (Доставка.Ссылка);
		СсылкаДоставка = Документы.Доработка_Доставка.ПолучитьСсылку(ИД);
		ОбъектДоставка = СсылкаДоставка.ПолучитьОбъект();
		
		//обновляем параметры
		ОбъектДоставка.Комментарий =Доставка.Комментарий; 
		
		Если Доставка.Статус = "" Тогда
			ОбъектДоставка.Статус = "";
		Иначе
			ОбъектДоставка.Статус = Перечисления.СтатусыДоставок_Доработка [СтрЗаменить(Доставка.Статус, " ", "")]; 
		КонецЕсли;
		
		ДвДанныеФото = Base64Значение(Доставка.Фото);
		ОбъектДоставка.Фото = Новый ХранилищеЗначения(ДвДанныеФото); 
		ОбъектДоставка.Записать();
		
	КонецЦикла;
	
	Возврат Ответ; 
	
КонецФункции
``` 
</details>
